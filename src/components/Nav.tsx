import { SignedIn, SignedOut, UserButton } from "@clerk/nextjs";
import Link from "next/link";
import { getProfileForCurrentUser } from "@/src/lib/profile";

export default async function Nav() {
  // Get profile for signed-in users (will be null if not signed in)
  let profileId: number | null = null;
  try {
    const profile = await getProfileForCurrentUser();
    profileId = profile.id;
  } catch {
    // User not signed in, profileId stays null
  }

  return (
    <div className="navbar bg-white shadow-sm">
      <div className="navbar-start">
        <SignedOut>
          <Link href={"/login"}>
          <svg
          className="w-6 h-6 text-gray-700"
            viewBox="0 1959 24 20" width="48" height="48"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              fill="#7587a0"
              fillRule="evenodd"
              d="M20.0382507,1959 C20.0352403,1959 20.0322298,1959.002 20.0292194,1959.002 C20.0262089,1959.002 20.024202,1959 20.0211915,1959 L20.0382507,1959 Z M24,1963 C24,1963.552 23.5504398,1964 22.9965174,1964 L21.0587925,1964 L21.0587925,1966 C21.0587925,1966.552 20.5921731,1967 20.0382507,1967 L20.0211915,1967 C19.4662657,1967 19.0518273,1966.552 19.0518273,1966 L19.0518273,1964 L16.9756219,1964 C16.4216995,1964 15.9721393,1963.552 15.9721393,1963 C15.9721393,1962.448 16.4216995,1962 16.9756219,1962 L19.0518273,1962 L19.0518273,1960 C19.0518273,1959.451 19.4793109,1959.007 20.0292194,1959.002 C20.5801313,1959.007 21.0587925,1959.451 21.0587925,1960 L21.0587925,1962 L22.9965174,1962 C23.5504398,1962 24,1962.448 24,1963 L24,1963 Z M12.0003552,1970.902 C11.9863064,1970.902 11.9722577,1970.9 11.9582089,1970.9 C11.9441601,1970.9 11.9301114,1970.902 11.9160626,1970.902 C10.829291,1970.879 9.95124372,1969.995 9.95124372,1968.906 C9.95124372,1967.803 10.8513676,1966.906 11.9582089,1966.906 C13.0650502,1966.906 13.9651741,1967.803 13.9651741,1968.906 C13.9651741,1969.995 13.0871268,1970.879 12.0003552,1970.902 Z M14.9947472,1971.495 C15.8266343,1970.527 16.2280273,1969.18 15.7965298,1967.724 C15.3981472,1966.38 14.2642119,1965.32 12.8924512,1965.011 C10.2693477,1964.422 7.94427854,1966.393 7.94427854,1968.906 C7.94427854,1969.899 8.32058451,1970.796 8.92167058,1971.495 C6.32967505,1972.55 4.41402678,1974.997 4.00962329,1977.867 C3.92533076,1978.466 4.40599892,1979 5.0121024,1979 C5.5078228,1979 5.92727853,1978.637 5.99752231,1978.147 C6.41095714,1975.24 8.90461138,1972.923 11.9160626,1972.902 C11.9301114,1972.902 11.9431567,1972.906 11.9582089,1972.906 C11.9722577,1972.906 11.9863064,1972.902 12.0003552,1972.902 C15.0118064,1972.923 17.5054607,1975.24 17.9188955,1978.148 C17.9881358,1978.637 18.4075915,1979 18.9043154,1979 C19.5104189,1979 19.991087,1978.466 19.9067945,1977.868 C19.502391,1974.998 17.5867428,1972.551 14.9947472,1971.495 Z"
            />
          </svg>
          </Link>
        </SignedOut>
        <SignedIn>
          <UserButton />
        </SignedIn>
      </div>
      <div className="navbar-center">
        <a href="/" className="btn btn-ghost text-xl font-display">
          <span className="text-yellow">=</span> ECOdometer <span className="text-yellow">=</span>
        </a>
      </div>
      <div className="navbar-end">
            {profileId ? (
                <Link className="btn" href={`/profile/${profileId}`}>
                <svg
                  viewBox="0 0 24 24"
                  xmlns="http://www.w3.org/2000/svg"
                  fill="#7587a0"
                >
                  <path d="m19.616 6.48.014-.017-4-3.24-1.26 1.554 2.067 1.674a2.99 2.99 0 0 0-1.394 3.062c.15.899.769 1.676 1.57 2.111.895.487 1.68.442 2.378.194L18.976 18a.996.996 0 0 1-1.39.922.995.995 0 0 1-.318-.217.996.996 0 0 1-.291-.705L17 16a2.98 2.98 0 0 0-.877-2.119A3 3 0 0 0 14 13h-1V5a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h7a2 2 0 0 0 2-2v-4h1c.136 0 .267.027.391.078a1.028 1.028 0 0 1 .531.533A.994.994 0 0 1 15 16l-.024 2c0 .406.079.799.236 1.168.151.359.368.68.641.951a2.97 2.97 0 0 0 2.123.881c.406 0 .798-.078 1.168-.236.358-.15.68-.367.951-.641A2.983 2.983 0 0 0 20.976 18L21 9a2.997 2.997 0 0 0-1.384-2.52zM11 8H4V5h7v3zm7 2a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/>
                </svg>
                </Link>
            ) : (
                <Link className="btn" href="/login">
                   <svg
                    viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg"
                    fill="#7587a0"
                  >
                    <path d="m19.616 6.48.014-.017-4-3.24-1.26 1.554 2.067 1.674a2.99 2.99 0 0 0-1.394 3.062c.15.899.769 1.676 1.57 2.111.895.487 1.68.442 2.378.194L18.976 18a.996.996 0 0 1-1.39.922.995.995 0 0 1-.318-.217.996.996 0 0 1-.291-.705L17 16a2.98 2.98 0 0 0-.877-2.119A3 3 0 0 0 14 13h-1V5a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h7a2 2 0 0 0 2-2v-4h1c.136 0 .267.027.391.078a1.028 1.028 0 0 1 .531.533A.994.994 0 0 1 15 16l-.024 2c0 .406.079.799.236 1.168.151.359.368.68.641.951a2.97 2.97 0 0 0 2.123.881c.406 0 .798-.078 1.168-.236.358-.15.68-.367.951-.641A2.983 2.983 0 0 0 20.976 18L21 9a2.997 2.997 0 0 0-1.384-2.52zM11 8H4V5h7v3zm7 2a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/>
                  </svg>
                </Link>
            )}

      </div>
    </div>
  );
}
